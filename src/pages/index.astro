---
import Base from "../layout/Base.astro";
import { supabase } from "../lib/supabase";

// Check for existing session
const accessToken = Astro.cookies.get("sb-access-token");
const refreshToken = Astro.cookies.get("sb-refresh-token");

let isLoggedIn = false;

if (accessToken && refreshToken) {
  const { data } = await supabase.auth.setSession({
    refresh_token: refreshToken.value,
    access_token: accessToken.value,
  });

  if (data?.user) {
    isLoggedIn = true;
  }
}
---

<Base title="Home">
  <h1>Welcome</h1>
  {
    isLoggedIn ? (
      <p>
        You are logged in. <a href="/dashboard">Go to Dashboard</a>
      </p>
    ) : (
      <p>
        <a href="/signin">Sign in</a> or <a href="/register">Register</a> to
        access the dashboard.
      </p>
    )
  }
</Base>
